/* Include point‐lookup formats */
%include "/sasdata/rqcral/readonly/MOD12005/OUTPUT/points_secured_CIDSC_vantage.txt";
%include "/sasdata/rqcral/readonly/MOD12005/OUTPUT/points_secured_vantage.txt";
%include "/sasdata/rqcral/readonly/MOD12005/OUTPUT/points_unsec_CIDSC_vantage.txt";
%include "/sasdata/rqcral/readonly/MOD12005/OUTPUT/points_unsec_vantage.txt";

/* 1. Score Secured: CIDS + Vantage4 */
data sc_sec_scored_CIDS_V4;
  set sc_sec_data;
  where CIDS_COMM_flg="NOT MISSING" and Vantage_flg="NOT MISSING" and bad60_24m^=.;
  pts_CIDSC    = input(put(CIDS_COMM_score,pts1a.),best12.);
  pts_Vantage4 = input(put(Vantage4_score,pts2a.),best12.);
  pts_ttl      = sum(of pts_:);
run;

/* 2. Score Secured: Vantage4 only */
data sc_sec_scored_V4;
  set sc_sec_data;
  where CIDS_COMM_flg="MISSING" and Vantage_flg="NOT MISSING" and bad60_24m^=.;
  pts_Vantage4 = input(put(Vantage4_score,pts2a.),best12.);
  pts_ttl      = pts_Vantage4;
run;

/* 3. Score Unsecured: CIDS + Vantage4 */
data sc_unsec_scored_CIDS_V4;
  set sc_unsec_data;
  where CIDS_COMM_flg="NOT MISSING" and Vantage_flg="NOT MISSING" and bad60_24m^=.;
  pts_CIDSC    = input(put(CIDS_COMM_score,pts1a.),best12.);
  pts_Vantage4 = input(put(Vantage4_score,pts2a.),best12.);
  pts_ttl      = sum(of pts_:);
run;

/* 4. Score Unsecured: Vantage4 only */
data sc_unsec_scored_V4;
  set sc_unsec_data;
  where CIDS_COMM_flg="MISSING" and Vantage_flg="NOT MISSING" and bad60_24m^=.;
  pts_Vantage4 = input(put(Vantage4_score,pts2a.),best12.);
  pts_ttl      = pts_Vantage4;
run;

/* 5. Somers' D – Secured: CIDS + V4 */
proc logistic data=sc_sec_scored_CIDS_V4 noprint;
  model bad60_24m(event='1') = pts_ttl;
  weight wt;
  ods output Association=assoc1;
run;
data somers1;
  set assoc1;
  where Label2="Somers' D";
  Segment="Secured: CIDS+V4";
  Somers_D=input(cValue2,best12.);
  keep Segment Somers_D;
run;

/* 6. Somers' D – Secured: V4 only */
proc logistic data=sc_sec_scored_V4 noprint;
  model bad60_24m(event='1') = pts_ttl;
  weight wt;
  ods output Association=assoc2;
run;
data somers2;
  set assoc2;
  where Label2="Somers' D";
  Segment="Secured: V4 only";
  Somers_D=input(cValue2,best12.);
  keep Segment Somers_D;
run;

/* 7. Somers' D – Unsecured: CIDS + V4 */
proc logistic data=sc_unsec_scored_CIDS_V4 noprint;
  model bad60_24m(event='1') = pts_ttl;
  weight wt;
  ods output Association=assoc3;
run;
data somers3;
  set assoc3;
  where Label2="Somers' D";
  Segment="Unsecured: CIDS+V4";
  Somers_D=input(cValue2,best12.);
  keep Segment Somers_D;
run;

/* 8. Somers' D – Unsecured: V4 only */
proc logistic data=sc_unsec_scored_V4 noprint;
  model bad60_24m(event='1') = pts_ttl;
  weight wt;
  ods output Association=assoc4;
run;
data somers4;
  set assoc4;
  where Label2="Somers' D";
  Segment="Unsecured: V4 only";
  Somers_D=input(cValue2,best12.);
  keep Segment Somers_D;
run;

/* 9. Combine and print all Somers' D */
data somers_all;
  set somers1 somers2 somers3 somers4;
run;
proc print data=somers_all noobs label;
  var Segment Somers_D;
  format Somers_D 6.3;
run;
